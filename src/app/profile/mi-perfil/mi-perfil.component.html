<!-- Botón Volver -->
<button mat-icon-button class="back-button" (click)="goBack()">
  <mat-icon>arrow_back</mat-icon>
</button>

<ng-container *ngIf="!loading; else cargando">
  <!-- Tarjeta con datos del perfil -->
  <mat-card class="profile-card">
    <mat-card-header>
      <div mat-card-avatar class="avatar-container">
        <img *ngFor="let url of profile.image_urls" [src]="url" class="avatar">
      </div>
      <mat-card-title>{{ profile.nombre }} {{ profile.apellido }}</mat-card-title>
      <mat-card-subtitle>{{ profile.role | titlecase }}</mat-card-subtitle>
    </mat-card-header>
    <mat-card-content>
      <p><strong>Edad:</strong> {{ profile.edad }}</p>
      <p><strong>DNI:</strong> {{ profile.dni }}</p>
    </mat-card-content>
  </mat-card>

  <!-- Mis Horarios (solo especialistas) -->
  <section *ngIf="profile.role==='especialista'" class="horarios-section">
    <h2>Mis Horarios</h2>

    <!-- FormGroup que envuelve el FormArray -->
    <form [formGroup]="scheduleForm">
      <div *ngFor="let spec of profile.specialties">
        <div class="spec-header">
          <h3>{{ spec }}</h3>
          <button mat-mini-fab color="primary" (click)="addEntry(spec)">
            <mat-icon>add</mat-icon>
          </button>
        </div>
      </div>

      <div formArrayName="entries">
        <div *ngFor="let grp of entries.controls; let i = index" [formGroupName]="i" class="entry-row">
          <mat-form-field appearance="outline">
            <mat-label>Día</mat-label>
            <mat-select formControlName="day">
              <mat-option *ngFor="let d of days" [value]="d">{{ d }}</mat-option>
            </mat-select>
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Desde</mat-label>
            <input matInput type="time" formControlName="from">
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Hasta</mat-label>
            <input matInput type="time" formControlName="to">
          </mat-form-field>

          <button mat-icon-button color="warn" (click)="removeEntry(i)">
            <mat-icon>delete</mat-icon>
          </button>
        </div>
      </div>

      <div class="actions">
        <button mat-flat-button color="accent" (click)="saveSchedule()">
          Guardar Horarios
        </button>
      </div>
    </form>
  </section>
</ng-container>

<ng-template #cargando>
  <div class="loading">Cargando perfil…</div>
</ng-template>
